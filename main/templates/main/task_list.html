{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">Tasks</h2>

  <!-- ðŸ”¼ Add Task Form -->
  <form method="post" class="mb-4 d-flex gap-2">
    {% csrf_token %}

    {{ form }}

<!--    <select name="user" id="user" class="form-control select2">-->
<!--        {% for user in usernames %}-->
<!--            <option value="{{ user.id }}">{{user.room}}-{{ user.username }}</option>-->
<!--        {% endfor %}-->
<!--    </select>-->
<!--    <select name="priority" id="priority" class="form-control">-->
<!--        {% for priority in priorities %}-->
<!--            <option value="{{ priority }}">{{ priority }}</option>-->
<!--        {% endfor %}-->
<!--    </select>-->
<!--    <input type="text" name="name" class="form-control" placeholder="Enter task name" required>-->
    <button type="submit" class="btn btn-primary">Add Task</button>
  </form>

  <!-- âœ… Todayâ€™s Tasks -->
  <h4>Today</h4>


<div class="row mb-3">
  <div class="col-md-3">
    <select id="priorityFilter" class="form-select">
      <option value="">All Priorities</option>
      <option value="low">Low</option>
      <option value="medium">Medium</option>
      <option value="high">High</option>
      <option value="critical">Critical</option>
    </select>
  </div>
  <div class="col-md-3">
    <select id="statusFilter" class="form-select">
      <option value="">All Status</option>
      <option value="done">Done</option>
      <option value="not_done">Not Done</option>
    </select>
  </div>
  <div class="col-md-2">
    <button id="resetFilters" class="btn btn-info w-100">Reset Filters</button>
  </div>
</div>



  <ul class="list-group mb-4" id="taskList">

    {% for task in today_tasks %}
    <li class="list-group-item d-flex justify-content-between align-items-center"  data-priority="{{ task.priority|lower }}"
             data-status="{% if task.status %}done{% else %}not_done{% endif %}" >
        <div>
          <strong> ({{ task.user.room }}-{{ task.user.username }})-{{ task.name }}
            {% if task.priority == "low" %}
            <span class="badge bg-success">{{ task.priority|title }}</span>
            {% elif task.priority == "medium" %}
            <span class="badge bg-info">{{ task.priority|title }}</span>
            {% elif task.priority == "high" %}
            <span class="badge bg-danger">{{ task.priority|title }}</span>
            {% elif task.priority == "critical" %}
            <span class="badge bg-dark">{{ task.priority|title }}</span>
            {% endif %}
          </strong><br>
          <small class="text-muted">Created at: {{ task.created_at|date:"M. j, Y, g:i a" }}</small><br>
          {% if task.completed_at %}
            <small class="text-success">Completed at: {{ task.completed_at|date:"M. j, Y, g:i a" }}</small>
          {% endif %}
        </div>
        <form method="post" action="{% url 'toggle-status' task.id %}">
          {% csrf_token %}
          <input type="checkbox" name="status"
                 {% if task.status %}checked{% endif %}
                 onchange="this.form.submit();">
        </form>
      </li>
    {% empty %}
      <li class="list-group-item">No tasks today.</li>
    {% endfor %}
  </ul>

<!--  &lt;!&ndash; ðŸ—“ Previous Days (Grouped by Date) &ndash;&gt;-->
<!--  <h4>Previous Days</h4>-->
<!--  {% regroup previous_tasks by created_at.date as day_groups %}-->
<!--  {% for day in day_groups %}-->
<!--    <h5 class="mt-4">{{ day.grouper|date:"M j, Y (D)" }}</h5>-->
<!--    <ul class="list-group mb-3">-->
<!--      {% for task in day.list %}-->
<!--        <li class="list-group-item d-flex justify-content-between align-items-center">-->
<!--          <div>-->
<!--            <strong>({{ task.user.room }}-{{ task.user.username }})-{{ task.name }}-->
<!--              {% if task.priority == "low" %}-->
<!--              <span class="badge bg-success">{{ task.priority|title }}</span>-->
<!--              {% elif task.priority == "medium" %}-->
<!--              <span class="badge bg-info">{{ task.priority|title }}</span>-->
<!--              {% elif task.priority == "high" %}-->
<!--              <span class="badge bg-danger">{{ task.priority|title }}</span>-->
<!--              {% elif task.priority == "critical" %}-->
<!--              <span class="badge bg-dark">{{ task.priority|title }}</span>-->
<!--              {% endif %}-->
<!--            </strong><br>-->
<!--            <small class="text-muted">Created at: {{ task.created_at|date:"M. j, Y, g:i a" }}</small><br>-->
<!--            {% if task.completed_at %}-->
<!--              <small class="text-success">Completed at: {{ task.completed_at|date:"M. j, Y, g:i a" }}</small>-->
<!--            {% endif %}-->
<!--          </div>-->
<!--          <form method="post" action="{% url 'toggle-status' task.id %}">-->
<!--            {% csrf_token %}-->
<!--            <input type="checkbox" name="status"-->
<!--                   {% if task.status %}checked{% endif %}-->
<!--                   onchange="this.form.submit();">-->
<!--          </form>-->
<!--        </li>-->
<!--      {% endfor %}-->
<!--    </ul>-->
<!--  {% empty %}-->
<!--    <p>No previous tasks.</p>-->
<!--  {% endfor %}-->
</div>
{% endblock %}




{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    const priorityFilter = document.getElementById('priorityFilter');
    const statusFilter = document.getElementById('statusFilter');
    const resetButton = document.getElementById('resetFilters');
    const tasks = document.querySelectorAll('#taskList li');

    function filterTasks() {
        const priority = priorityFilter.value.trim().toLowerCase();
        const status = statusFilter.value.trim().toLowerCase();

    tasks.forEach(task => {
      const matchesPriority = !priority || task.dataset.priority === priority;
      const matchesStatus = !status || task.dataset.status === status;

      if (matchesPriority && matchesStatus) {
        task.classList.remove('hidden');
      } else {
        task.classList.add('hidden');
      }
    });
    }

    // Event listeners
    priorityFilter.addEventListener('change', filterTasks);
    statusFilter.addEventListener('change', filterTasks);

    resetButton.addEventListener('click', function() {
        priorityFilter.value = '';
        statusFilter.value = '';
        filterTasks(); // Show all
    });

    // Initial load: show all
    filterTasks();
});
</script>
{% endblock %}






